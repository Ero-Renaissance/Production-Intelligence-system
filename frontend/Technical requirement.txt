===============================================================================
TECHNICAL REQUIREMENT SPECIFICATION (TRS) - PRODUCTION INTELLIGENCE PLATFORM
FRONTEND APPLICATION
===============================================================================
Target Deployment: Azure Static Web Apps with Azure CDN/Front Door
Backend Integration: FastAPI + Pydantic v2 contracts (see SYSTEM_ARCHITECTURE.md)
Current Phase: P1 - Contracts & Mocks (Frontend with MSW â†’ P2 Backend Integration)

CONTENTS
1.  Project Overview & Business Context
2.  Tech Stack & Architecture Alignment  
3.  API Integration & Contract-First Design
4.  User Journeys & Role-Based Features
5.  Component Architecture & Design System
6.  Routing & Navigation Hierarchy
7.  State Management & Real-Time Data
8.  Performance & Reliability Requirements
9.  Security & Compliance Integration
10. Testing Strategy & Quality Gates
11. Deployment & Environment Strategy
12. Observability & Monitoring
13. Phased Delivery Alignment
14. Definition of Done (DoD)
===============================================================================

1. PROJECT OVERVIEW & BUSINESS CONTEXT
-------------------------------------------------------------------------------
Build a **Production Intelligence Platform Frontend** that serves as the primary
interface for oil and gas production monitoring, gap analysis, and optimization.

### Core Business Value
â€¢ Unified monitoring across Asset â†’ Production Hub â†’ Facility â†’ Well hierarchy
â€¢ Network overlays for Oil, Domestic Gas, Export Gas, and Flared Gas KPIs
â€¢ Real-time gap detection with ML-powered explanations and predictions
â€¢ Terminal operations management with cargo forecasting and endurance tracking
â€¢ Optimization recommendations with closed-loop outcome tracking

### Target Users & Primary Journeys
â€¢ **Production Monitoring Engineers**: Real-time surveillance, gap detection, rapid response
â€¢ **Performance Leads**: KPI tracking, deferment analysis, target attainment
â€¢ **Production Programmers/Technologists**: Optimization, simulation, scenario analysis  
â€¢ **Terminal Operations**: Cargo readiness, endurance forecasting, export planning
â€¢ **Leadership**: High-level KPIs, trend insights, decision support

### Key User Journeys
1. "See today's performance": Overview â†’ Asset â†’ Hub â†’ Facility KPIs
2. "Find and explain gaps": Gap analysis with drivers, streams, timeline
3. "Get ahead of problems": Predictive alerts for constraints and breaches
4. "Plan cargo/export": Terminal overview with endurance and readiness forecasts
5. "Optimize and simulate": Recommended actions with before/after scenarios
6. "Review outcomes": Track recommendation adoption and realized impact

2. TECH STACK & ARCHITECTURE ALIGNMENT
-------------------------------------------------------------------------------
### Frontend Stack (Contract-First Design)
â€¢ **Framework**: React 18 + TypeScript (strict mode)
â€¢ **Build Tool**: Vite with optimized production builds
â€¢ **Routing**: React Router v6 with nested routes and URL state management
â€¢ **State Management**: TanStack Query (React Query) for server state
â€¢ **Styling**: TailwindCSS with custom design tokens for operations
â€¢ **Validation**: Zod schemas aligned with backend Pydantic v2 contracts
â€¢ **Charts**: ApexCharts for production visualization and trends
â€¢ **Testing**: Jest + React Testing Library + Cypress E2E
â€¢ **Deployment**: Azure Static Web Apps with CDN optimization

### API Integration Strategy
â€¢ **Backend API**: FastAPI with versioned endpoints (/api/v1)
â€¢ **Contracts**: OpenAPI 3.0 specification with Zod client-side validation
â€¢ **Error Handling**: RFC 7807 Problem Details for HTTP APIs
â€¢ **Authentication**: Entra ID OIDC + MSAL.js integration (P6 phase)
â€¢ **Caching**: React Query with Redis-backed backend caching
â€¢ **Real-time**: WebSocket connections for live updates (future)

3. API INTEGRATION & CONTRACT-FIRST DESIGN
-------------------------------------------------------------------------------
### Core API Endpoints (v1)
```
GET /api/v1/summary                          # System & asset KPIs with flared gas
GET /api/v1/assets                           # Asset â†’ Hub â†’ Facility hierarchy  
GET /api/v1/assets/{assetId}                 # Individual asset drill-down
GET /api/v1/gap-drivers                      # Top deferment contributors
GET /api/v1/production-flow                  # Topology (units, facilities, edges)
GET /api/v1/terminal/{terminalId}/operations # Terminal KPIs & cargo schedule
GET /api/v1/hubs/{hubId}/performance         # Hub timeseries & events
GET /api/v1/facilities/{facilityId}/wells    # Well table per facility
GET /api/v1/wells/{wellId}                   # Well detail & latest data
GET /api/v1/wells/{wellId}/timeseries        # Well performance history
```

### Data Contract Standards
â€¢ **Units**: Consistent across all endpoints (bbl/d, mscf/d, kbbl/d, MMbbl)
â€¢ **Timestamps**: ISO 8601 UTC format with timezone handling
â€¢ **Flared Gas**: Always present as KPI default across all network views
â€¢ **Networks**: Oil, Domestic Gas, Export Gas with consistent metrics structure
â€¢ **Terminal KPIs**: capacity(MMbbl), grossStock(MMbbl), readyCrude(kbbl/d), 
  productionRate(kbbl/d), endurance(days)

### Error Handling & Resilience
â€¢ **Graceful Degradation**: Cached fallbacks during upstream outages
â€¢ **Loading States**: Progressive loading with skeleton screens
â€¢ **Error Boundaries**: Component-level error isolation
â€¢ **Retry Logic**: Exponential backoff for transient failures
â€¢ **Offline Support**: Service worker for critical functionality

4. USER JOURNEYS & ROLE-BASED FEATURES
-------------------------------------------------------------------------------
### Navigation Hierarchy
```
Overview Dashboard
â”œâ”€â”€ Asset (East/West) Performance
â”‚   â”œâ”€â”€ Production Hub Performance  
â”‚   â”‚   â”œâ”€â”€ Facility Details
â”‚   â”‚   â”‚   â””â”€â”€ Well Table & Details
â”‚   â”‚   â””â”€â”€ Network Analysis (Oil/Gas overlays)
â”‚   â””â”€â”€ Asset-level Gap Analysis
â”œâ”€â”€ Terminal Operations
â”‚   â”œâ”€â”€ Bonny Terminal Operations
â”‚   â”œâ”€â”€ Forcados Terminal Operations  
â”‚   â””â”€â”€ Sea Eagle Terminal Operations
â”œâ”€â”€ Gap Analysis & Optimization
â”‚   â”œâ”€â”€ Gap Drivers Table
â”‚   â”œâ”€â”€ Constraint Detection
â”‚   â””â”€â”€ Recommendation Tracking
â””â”€â”€ Performance Analytics
    â”œâ”€â”€ Predictive Alerts
    â”œâ”€â”€ Scenario Simulation
    â””â”€â”€ Outcome Analysis
```

### Role-Based UI Features
â€¢ **Production Monitoring**: Real-time dashboards, alert notifications, drill-down navigation
â€¢ **Performance Management**: KPI tracking, trend analysis, target vs actual comparisons
â€¢ **Optimization**: Simulation tools, recommendation reviews, implementation tracking
â€¢ **Terminal Operations**: Cargo scheduling, endurance monitoring, vessel coordination
â€¢ **Leadership**: Executive summaries, high-level trends, risk indicators

5. COMPONENT ARCHITECTURE & DESIGN SYSTEM
-------------------------------------------------------------------------------
### Core Component Categories
```
Layout Components:
â”œâ”€â”€ AppShell (Header + Sidebar + Main)
â”œâ”€â”€ Header (Navigation + User + Notifications)
â”œâ”€â”€ Sidebar (Hierarchical navigation menu)
â””â”€â”€ PageLayout (Breadcrumbs + Title + Content)

Dashboard Components:
â”œâ”€â”€ SummaryStats (Asset KPIs with trend indicators)
â”œâ”€â”€ GapDriversTable (Prioritized gap analysis)
â”œâ”€â”€ TerminalOperations (KPIs + cargo schedule)
â””â”€â”€ ProductionFlowMap (Visual topology)

Data Visualization:
â”œâ”€â”€ TimeSeriesChart (ApexCharts integration)
â”œâ”€â”€ KPICard (Metric + trend + comparison)
â”œâ”€â”€ StatusIndicator (Health/constraint states)
â””â”€â”€ NetworkOverlay (Oil/Gas/Flared visualization)

Interactive Components:
â”œâ”€â”€ DrillDownTable (Sortable, filterable data)
â”œâ”€â”€ TimeframeSelector (Period selection)
â”œâ”€â”€ FilterPanel (Multi-criteria filtering)
â””â”€â”€ ActionPanel (Recommendations + simulation)
```

### Design System Standards
â€¢ **Color Palette**: 
  - Oil Network: Blue scale (#075985 to #e0f2fe)
  - Export Gas: Green scale (#065f46 to #d1fae5)  
  - Domestic Gas: Purple scale (#6b21a8 to #f3e8ff)
  - Flared Gas: Orange scale (#ea580c to #fed7aa)
â€¢ **Typography**: Inter font family with consistent scale
â€¢ **Spacing**: 4px base unit with consistent grid system
â€¢ **Icons**: Lucide React with semantic naming
â€¢ **Status Colors**: Green (normal), Yellow (warning), Red (critical)

6. ROUTING & NAVIGATION HIERARCHY
-------------------------------------------------------------------------------
### URL Structure & State Management
```
/                                    # Overview dashboard
/asset/:assetId                      # Asset performance (east|west)
/asset/:assetId/hub/:hubId           # Production hub detail
/facility/:facilityId                # Facility KPIs and wells
/well/:wellId                        # Individual well performance
/terminal/:terminalId                # Terminal operations
/gaps                                # Gap analysis dashboard
/optimization                        # Recommendations & simulation
/analytics                           # Performance analytics
```

### URL State Management
â€¢ **Filter State**: Embedded in URL parameters (timeframe, network, status)
â€¢ **Navigation State**: Breadcrumb trail with context preservation
â€¢ **Deep Linking**: All dashboard states shareable via URL
â€¢ **Back/Forward**: Browser navigation with state restoration

7. STATE MANAGEMENT & REAL-TIME DATA
-------------------------------------------------------------------------------
### React Query Configuration
â€¢ **Polling Strategy**: 60-second intervals for production data
â€¢ **Cache Strategy**: 30s stale time, 10min garbage collection
â€¢ **Background Updates**: Silent refetch on window focus
â€¢ **Optimistic Updates**: Immediate UI feedback for actions
â€¢ **Error Boundaries**: Query-level error isolation

### Data Freshness Strategy
â€¢ **Real-time KPIs**: â‰¤ 1 min freshness from Redis cache
â€¢ **Historical Trends**: Hourly/daily aggregation from Postgres
â€¢ **Predictive Data**: Updated on model runs (configurable intervals)
â€¢ **Freshness Indicators**: Visual timestamps and data age warnings

### Local State Management
â€¢ **URL Parameters**: Filter and navigation state
â€¢ **Component State**: UI interactions and form data
â€¢ **Context**: User preferences and role-based permissions
â€¢ **Session Storage**: Temporary data and draft states

8. PERFORMANCE & RELIABILITY REQUIREMENTS
-------------------------------------------------------------------------------
### Performance Targets
â€¢ **Initial Load**: < 2s for dashboard on 3G connection
â€¢ **Navigation**: < 500ms for cached route transitions
â€¢ **API Response**: P95 â‰¤ 500ms for cached KPIs, â‰¤ 1.5s for aggregates
â€¢ **Bundle Size**: < 1MB initial JS bundle, code splitting for routes
â€¢ **Lighthouse Score**: 90+ Performance, 100 Accessibility, 90+ Best Practices

### Reliability Requirements
â€¢ **Availability**: 99.5% uptime target with graceful degradation
â€¢ **Error Recovery**: Automatic retry with exponential backoff
â€¢ **Offline Capability**: Service worker for critical dashboard functionality
â€¢ **Progressive Loading**: Skeleton screens with incremental data loading
â€¢ **Memory Management**: Efficient cleanup of query caches and subscriptions

9. SECURITY & COMPLIANCE INTEGRATION
-------------------------------------------------------------------------------
### Authentication & Authorization (P6 Phase)
â€¢ **Identity Provider**: Azure Entra ID with OIDC/OAuth 2.0
â€¢ **Client Library**: MSAL.js v3 for token management
â€¢ **Role-Based Access**: UI features hidden based on user roles
â€¢ **Token Security**: Secure storage with automatic refresh
â€¢ **Session Management**: Idle timeout and concurrent session handling

### Security Features
â€¢ **Content Security Policy**: Strict CSP headers for XSS protection
â€¢ **Data Validation**: Client-side Zod validation matching backend contracts
â€¢ **Audit Trail**: User action logging for sensitive operations
â€¢ **Secure Communication**: HTTPS only with certificate pinning
â€¢ **Sensitive Data**: No storage of credentials or sensitive data in browser

### Compliance Requirements
â€¢ **Data Residency**: EU/US data handling per enterprise policy
â€¢ **Access Logging**: Detailed audit logs for regulatory compliance
â€¢ **Data Masking**: Sensitive field protection in UI
â€¢ **Retention Policies**: Client-side data cleanup per retention schedules

10. TESTING STRATEGY & QUALITY GATES
-------------------------------------------------------------------------------
### Testing Pyramid
â€¢ **Unit Tests**: 80%+ coverage for utilities, hooks, and pure components
â€¢ **Integration Tests**: API integration with MSW mock validation
â€¢ **Component Tests**: React Testing Library for user interactions
â€¢ **E2E Tests**: Cypress for critical user journeys
â€¢ **Contract Tests**: Zod schema validation against OpenAPI specs

### Quality Gates
â€¢ **Type Safety**: Zero TypeScript errors with strict mode
â€¢ **Accessibility**: WCAG 2.1 AA compliance verified by axe-core
â€¢ **Performance**: Bundle size budgets and Lighthouse CI checks
â€¢ **Security**: Static analysis with ESLint security rules
â€¢ **Code Quality**: Prettier formatting and ESLint compliance

### Test Environment Strategy
â€¢ **Development**: MSW with comprehensive mock data
â€¢ **Integration**: Backend contract tests with real API schemas
â€¢ **Staging**: Full integration with staging backend services
â€¢ **Production**: Real user monitoring and error tracking

11. DEPLOYMENT & ENVIRONMENT STRATEGY
-------------------------------------------------------------------------------
### Environment Configuration
â€¢ **Development**: Local Vite dev server with MSW mocking
â€¢ **Testing**: Azure Static Web Apps preview deployments
â€¢ **Staging**: Full integration with staging backend APIs
â€¢ **Production**: Azure Static Web Apps with CDN and custom domain

### CI/CD Pipeline
â€¢ **Build Pipeline**: GitHub Actions with Node.js 18+
â€¢ **Quality Gates**: Lint, type check, test, build, security scan
â€¢ **Deployment**: Automatic deployment on main branch merge
â€¢ **Rollback**: Blue-green deployment with instant rollback capability
â€¢ **Monitoring**: Real User Monitoring with Application Insights

### Configuration Management
â€¢ **Environment Variables**: VITE_* prefix for build-time configuration
â€¢ **Feature Flags**: Runtime feature toggles for gradual rollouts
â€¢ **API Endpoints**: Environment-specific backend URLs
â€¢ **Cache Strategy**: CDN cache headers and invalidation rules

12. OBSERVABILITY & MONITORING
-------------------------------------------------------------------------------
### Frontend Monitoring
â€¢ **Application Insights**: Page views, user flows, performance metrics
â€¢ **Error Tracking**: Unhandled exceptions with stack traces and context
â€¢ **Performance Monitoring**: Core Web Vitals and custom metrics
â€¢ **User Analytics**: Feature usage and user journey analysis
â€¢ **Real User Monitoring**: Actual user performance in production

### Debugging & Diagnostics
â€¢ **React DevTools**: Component tree and state inspection
â€¢ **Query DevTools**: TanStack Query cache and network inspection
â€¢ **Console Logging**: Structured logging with correlation IDs
â€¢ **Error Boundaries**: Component-level error isolation with reporting
â€¢ **Health Checks**: Frontend health endpoint for uptime monitoring

13. PHASED DELIVERY ALIGNMENT
-------------------------------------------------------------------------------
### P1: Contracts & Mocks (Current)
âœ… React SPA with comprehensive MSW mocking
âœ… Component library with design system
âœ… Routing and navigation hierarchy
âœ… Zod schemas aligned with backend contracts
âœ… Testing framework with high coverage

### P2: Backend Integration
ðŸ”„ Replace MSW with real FastAPI backend calls
ðŸ”„ Implement error handling and retry logic
ðŸ”„ Add data freshness indicators and loading states
ðŸ”„ Performance optimization and caching strategy

### P3: Terminal & Pipeline Features  
ðŸ”„ Enhanced terminal operations dashboard
ðŸ”„ Pipeline constraint visualization
ðŸ”„ Cargo scheduling and endurance forecasting

### P4: Predictive Intelligence
ðŸ”„ Gap prediction and early warning systems
ðŸ”„ Constraint detection with automatic alerts
ðŸ”„ Advanced analytics and trending

### P5: Optimization & Simulation
ðŸ”„ Recommendation review and approval workflow
ðŸ”„ What-if scenario simulation interface
ðŸ”„ Outcome tracking and learning feedback

### P6: Security & Governance Hardening
ðŸ”„ Entra ID integration with MSAL.js
ðŸ”„ Role-based access control implementation
ðŸ”„ Audit logging and compliance features
ðŸ”„ Production monitoring and SLO dashboards

14. DEFINITION OF DONE (DoD)
-------------------------------------------------------------------------------
### Feature Completion Criteria
âœ… **Functionality**: All user stories completed with acceptance criteria met
âœ… **Design**: UI/UX approved with design system compliance
âœ… **Testing**: Unit tests â‰¥80%, integration tests for API calls, E2E for journeys
âœ… **Performance**: Meets performance budgets and Lighthouse scores
âœ… **Accessibility**: WCAG 2.1 AA compliance verified
âœ… **Security**: Security review completed, vulnerabilities addressed
âœ… **Documentation**: Technical documentation and user guides updated
âœ… **Code Quality**: Type-safe, linted, formatted, and reviewed
âœ… **Deployment**: Successfully deployed to staging and validated
âœ… **Monitoring**: Observability instrumentation in place

### Sprint/Release Criteria
âœ… **Contract Alignment**: API contracts validated with backend team
âœ… **Cross-browser Testing**: Chrome, Firefox, Safari, Edge compatibility
âœ… **Responsive Design**: Mobile, tablet, desktop layouts tested
âœ… **Data Integration**: Real data flows tested in staging environment
âœ… **User Acceptance**: Stakeholder sign-off from target user groups
âœ… **Production Readiness**: Monitoring, alerting, and rollback procedures ready

===============================================================================
This TRS serves as the primary technical reference for frontend development,
aligned with the Production Intelligence Platform architecture and business 
objectives. All implementation decisions should reference this document and
the corresponding backend SYSTEM_ARCHITECTURE.md for integration points.
=============================================================================== 